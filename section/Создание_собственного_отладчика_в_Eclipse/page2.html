
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <base href="../../" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Web-разработка, PHP, Javascript, jQuery, Joomla, Создание собственного отладчика в Eclipse" />
    <meta name="rights" content="teafortwo.ru" />
    <meta name="description" content="разработка плагинов для Eclipse, Web-разработка, разработка расширений для joomla, программные разработки для изучения иностранных языков" />
    <meta name="generator" content="Psytronica.ru" />
    <meta content='IE=edge' http-equiv='X-UA-Compatible'/>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>
	<meta name="yandex-verification" content="70dcadaa2851af41" />
	<link href="./yinyang.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />

    <title>Psytronica.ru - Web-разработка, инстранные языки, Eclipse и разные разности - Создание собственного отладчика в Eclipse</title>
    <link rel="stylesheet" href="./css/psytronica1.css" type="text/css" media="screen" /> 
    <script src="./js/psytronica2.js" type="text/javascript"></script>




</head>
<body id='psy_body_section_Sozdanie_sobstvennogo_otladchika_v_Eclipse' onload="setBodyWidth();">
<div id="psy_body_inner">

<div id="psytronica_menu_wrapper">
    <div id="psytronica_menu" class="ddsmoothmenu">


        <ul>
            <li><a href='./index.html' class='psy_noactive'>Главная</a></li>
            <li><a href='./search/label/разработки.html' class='psy_noactive'>Мои разработки</a>
            </li>
          <li><a href='./me.html' class='psy_noactive'>Контакты</a></li>
        </ul>



	<div id="psytronica_search" class='psy_search_div'>
		  <input type="text" id='psy_search'  title="keyword" placeholder="Поиск..."/>
		  <div id='psy_search_results'></div>
	</div>

        <br style="clear: left" />
    </div> <!-- end of psytronica_menu -->
</div> <!-- end of psytronica_menu_wrapper -->


<div id="psytronica_header_wrapper" class="psytronica_header_other">
    <div id="psytronica_header" class="header_home">
        
<div id="psytronica_sitetitle_bar">
    <div id="site_title"><h1><a href='./index.html' class='psy_noactive'>Psytronica</a></h1></div>

    <div id="mid_title">
        Web-разработка, иностранные языки, Eclipse  и разные разности
    </div>
    <div class="cleaner"></div>
</div>

        

    </div> <!-- end of header -->
</div> <!-- end of header_wrapper -->


<div id="psytronica_after_header">

            <h3><a href='./2015/10/joomla-3x-zygoprofile-hkmprofile.html' class='psy_noactive'>Zygo Profile</a></h3>
            <h3><a href='./2016/10/shabdatra.html' class='psy_noactive'>Санскрит - словоформы</a></h3>
            <h3><a href='./2015/10/verbos-irregulares-android-kivy-python.html' class='psy_noactive'>Verbos Irregulares</a></h3>

</div>







<a name="blog"></a>

<div id="psytronica_main_wrapper">

    <div id="psytronica_main_inner">
        <div id="psytronica_main">
            <div id="psytronica_content_area">

                
<h3 class="psy_content_head psy_content_head_section">Создание собственного отладчика в Eclipse</h3>
 
<div id="psytronica_blog">

<div class="psytronica_post even  psy_post_sections">
    <h2><a href="./p/4-3-eclipse.html">4. Пошаговое  прохождение, приостановка и другие действия</a></h2>

    <div class="date"><div class='psy_page_date'>03.11.2015</div></div>

    <div class="psytronica_post_content" >
        
<div dir="ltr" style="text-align: left;" trbidi="on">
<div style="text-align: right;">
<a href="http://codeandme.blogspot.ru/2013/11/debugger-4-stepping-suspending-and.html" target="_blank">Английский оригинал и исходные коды</a></div>
<br />
В прошлой части руководства мы создали базовую структуру нашего отладчика. В этой части мы поработаем над UI интеграцией.<br />
<br />
Когда отладчик запущен, Эклипс предоставляет различные действия на панели инструментов в зависимости того, что выбрано в Debug view. Существует четыре различных типа действий:<br />
<br />
<ul style="text-align: left;">
<li><b>Terminate</b> (завершение)</li>
<li><b>Suspend/Resume</b> (приостановка/возобновление)</li>
<li><b>Disconnect</b> (отключение)</li>
<li><b>Stepping</b> (пошаговое выполнение)</li>
</ul>
<br />
Для каждой из этих групп существуют интерфейсы (<b>ITerminate, ISuspendResume, IDisconnect </b>and <b>IStep</b>). Когда выбранный элемент осуществляет один из приведенных интерфейсов, становятся доступны соответствующие действия на панели инструментов. Активация элемента обрабатывается такими методами интерфейса как &nbsp;<b>canDisconnect(), canResume()..</b><br />
<br />
В этом руководстве мы будем шаг за шагом применять все эти возможности.<br />
<br />
<h4 style="text-align: left;">
Шаг 1. Приостановка/возобновление</h4>
<br />
Наш отладчик очень простой. У нас нет множества потоков, поэтому функционал приостановки/возобновления один и тот же, что для <b>DebugTarget</b>, <b>Thread</b> или <b>StackFrame</b> (мы вернемся к этому в следующих частях).<br />
<br />
Поскольку приостановка/возобновление уже реализованы, мы всего лишь внесем изменения в наш код и переместим <b>ISuspendResume</b> в наш базовый класс <b>TextDebugElement</b>.<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #f92672;">package</span> <span style="color: #f8f8f2;">com</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">codeandme</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">textinterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">model</span><span style="color: #f92672;">;</span>  
  
<span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">abstract</span> <span style="color: #66d9ef;">class</span> <span style="color: #a6e22e;">TextDebugElement</span> <span style="color: #66d9ef;">extends</span> <span style="color: #f8f8f2;">DebugElement</span> <span style="color: #66d9ef;">implements</span> <span style="color: #f8f8f2;">ISuspendResume</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IDisconnect</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">ITerminate</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IStep</span> <span style="color: #f92672;">{</span>  
  
 <span style="color: #75715e;">// FIXME for full source code see http://codeandme.googlecode.com/svn/trunk/blog/debugger/04/com.codeandme.textinterpreter.debugger/src/com/codeandme/textinterpreter/debugger/model/TextDebugElement.java  </span>
  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">enum</span> <span style="color: #f8f8f2;">State</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">NOT_STARTED</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">SUSPENDED</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">RESUMED</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">TERMINATED</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">STEPPING</span>  
 <span style="color: #f92672;">};</span>  
  
 <span style="color: #66d9ef;">private</span> <span style="color: #f8f8f2;">State</span> <span style="color: #f8f8f2;">mState</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">NOT_STARTED</span><span style="color: #f92672;">;</span>  
  
 <span style="color: #66d9ef;">protected</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">setState</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">State</span> <span style="color: #f8f8f2;">state</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #75715e;">// only the DebugTarget saves the correct state.  </span>
  <span style="color: #f92672;">((</span><span style="color: #f8f8f2;">TextDebugElement</span><span style="color: #f92672;">)</span> <span style="color: #f8f8f2;">getDebugTarget</span><span style="color: #f92672;">()).</span><span style="color: #a6e22e;">mState</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">state</span><span style="color: #f92672;">;</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #66d9ef;">protected</span> <span style="color: #f8f8f2;">State</span> <span style="color: #a6e22e;">getState</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #f92672;">((</span><span style="color: #f8f8f2;">TextDebugElement</span><span style="color: #f92672;">)</span> <span style="color: #f8f8f2;">getDebugTarget</span><span style="color: #f92672;">()).</span><span style="color: #a6e22e;">mState</span><span style="color: #f92672;">;</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #75715e;">// ************************************************************  </span>
 <span style="color: #75715e;">// ISuspendResume  </span>
 <span style="color: #75715e;">// ************************************************************  </span>
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">canResume</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #a6e22e;">isSuspended</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">canSuspend</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #75715e;">// we cannot interrupt our debugger once it is running  </span>
  <span style="color: #66d9ef;">return</span> <span style="color: #66d9ef;">false</span><span style="color: #f92672;">;</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">isSuspended</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">getState</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">==</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">SUSPENDED</span><span style="color: #f92672;">);</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">resume</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #75715e;">// resume request from eclipse  </span>
  
  <span style="color: #75715e;">// send resume request to debugger  </span>
  <span style="color: #f8f8f2;">getDebugTarget</span><span style="color: #f92672;">().</span><span style="color: #a6e22e;">fireModelEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">CONTINUE</span><span style="color: #f92672;">));</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">suspend</span><span style="color: #f92672;">()</span> <span style="color: #66d9ef;">throws</span> <span style="color: #f8f8f2;">DebugException</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">throw</span> <span style="color: #66d9ef;">new</span> <span style="color: #a6e22e;">DebugException</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">Status</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">IStatus</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">ERROR</span><span style="color: #f92672;">,</span> <span style="color: #e6db74;">"com.codeandme.textinterpreter.debugger"</span><span style="color: #f92672;">,</span> <span style="color: #e6db74;">"suspend() not supported"</span><span style="color: #f92672;">));</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
Любое действие, которое омжет быть вызвано из элемента панели инструментов, содержит метод <b>canSomething</b>(), который содержит проверку, необходимую для активации кнопок (строки 26-35). Что касается возобновления, это всего лишь вопрос посылки отладчику запроса на возобновление <b>ResumeRequest</b>.<br />
<br />
Перемещение в базовый класс позволяет любой из наших реализаций модели использовать возобновление. Кроме того, мы можем уничтожить некоторый устаревший код из <b>TextDebugTarget</b> и <b>TextThread</b>.<br />
<br />
<h4 style="text-align: left;">



Шаг 2. Поддержка реализации завершения и отключения.</h4>
<br />
Мы вновь добавляем функционал в базовый класс.<br />
<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #f92672;">package</span> <span style="color: #f8f8f2;">com</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">codeandme</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">textinterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">model</span><span style="color: #f92672;">;</span>  
  
<span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">abstract</span> <span style="color: #66d9ef;">class</span> <span style="color: #a6e22e;">TextDebugElement</span> <span style="color: #66d9ef;">extends</span> <span style="color: #f8f8f2;">DebugElement</span> <span style="color: #66d9ef;">implements</span> <span style="color: #f8f8f2;">ISuspendResume</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IDisconnect</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">ITerminate</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IStep</span> <span style="color: #f92672;">{</span>  
  
 <span style="color: #75715e;">// FIXME for full source code see http://codeandme.googlecode.com/svn/trunk/blog/debugger/04/com.codeandme.textinterpreter.debugger/src/com/codeandme/textinterpreter/debugger/model/TextDebugElement.java  </span>
  
 <span style="color: #75715e;">// ************************************************************  </span>
 <span style="color: #75715e;">// IDisconnect  </span>
 <span style="color: #75715e;">// ************************************************************  </span>
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">canDisconnect</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #a6e22e;">canTerminate</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">disconnect</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #75715e;">// disconnect request from eclipse  </span>
  
  <span style="color: #75715e;">// send disconnect request to debugger  </span>
  <span style="color: #f8f8f2;">getDebugTarget</span><span style="color: #f92672;">().</span><span style="color: #a6e22e;">fireModelEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">DisconnectRequest</span><span style="color: #f92672;">());</span>  
  
  <span style="color: #75715e;">// debugger is detached, simulate terminate event  </span>
  <span style="color: #f8f8f2;">getDebugTarget</span><span style="color: #f92672;">().</span><span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">TerminatedEvent</span><span style="color: #f92672;">());</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">isDisconnected</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #a6e22e;">isTerminated</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #75715e;">// ************************************************************  </span>
 <span style="color: #75715e;">// ITerminate  </span>
 <span style="color: #75715e;">// ************************************************************  </span>
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">canTerminate</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #f92672;">!</span><span style="color: #f8f8f2;">isTerminated</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">isTerminated</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">getState</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">==</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">TERMINATED</span><span style="color: #f92672;">);</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">terminate</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #75715e;">// terminate request from eclipse  </span>
  
  <span style="color: #75715e;">// send terminate request to debugger  </span>
  <span style="color: #f8f8f2;">getDebugTarget</span><span style="color: #f92672;">().</span><span style="color: #a6e22e;">fireModelEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">TerminateRequest</span><span style="color: #f92672;">());</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
В то время как <b>terminate</b>() мгновенно остановит отладочную сессию (вместе с интерпретатором), <b>disconnect</b>() всего лишь отключит отладчик Эклипса, но возобновит работу интерпретатора. По этой причине нам необходимо расширить событие <b>TextDebugger.handleEvent</b>().<br />
<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #a6e22e;">@Override</span>  
<span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IDebugEvent</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
 <span style="color: #f8f8f2;">System</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">out</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">println</span><span style="color: #f92672;">(</span><span style="color: #e6db74;">"Debugger.handleEvent() "</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
  
 <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">mIsStepping</span> <span style="color: #f92672;">=</span> <span style="color: #f92672;">(((</span><span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">)</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">).</span><span style="color: #a6e22e;">getType</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">==</span> <span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">STEP_OVER</span><span style="color: #f92672;">);</span>  
  <span style="color: #f8f8f2;">mInterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">resume</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #66d9ef;">else</span> <span style="color: #a6e22e;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">TerminateRequest</span><span style="color: #f92672;">)</span>  
  <span style="color: #f8f8f2;">mInterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">terminate</span><span style="color: #f92672;">();</span>  
  
 <span style="color: #66d9ef;">else</span> <span style="color: #a6e22e;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">DisconnectRequest</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">mInterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">setDebugger</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">null</span><span style="color: #f92672;">);</span>  
  <span style="color: #f8f8f2;">mInterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">resume</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
<h4 style="text-align: left;">
Шаг 3. Поддержка пошагового выполнения.</h4>
<br />
Сейчас перейдем к самому интересному: реализации пошагового выполнения. Наш вымышленный язык настолько прост, что он не поддерживает step into ни step return. Таким образом, остается только step over. Как и ранее, мы реализуем функционал базового класса.<br />
<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #f92672;">package</span> <span style="color: #f8f8f2;">com</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">codeandme</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">textinterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">model</span><span style="color: #f92672;">;</span>  
  
<span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">abstract</span> <span style="color: #66d9ef;">class</span> <span style="color: #a6e22e;">TextDebugElement</span> <span style="color: #66d9ef;">extends</span> <span style="color: #f8f8f2;">DebugElement</span> <span style="color: #66d9ef;">implements</span> <span style="color: #f8f8f2;">ISuspendResume</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IDisconnect</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">ITerminate</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IStep</span> <span style="color: #f92672;">{</span>  
  
 <span style="color: #75715e;">// FIXME for full source code see http://codeandme.googlecode.com/svn/trunk/blog/debugger/04/com.codeandme.textinterpreter.debugger/src/com/codeandme/textinterpreter/debugger/model/TextDebugElement.java  </span>
  
 <span style="color: #75715e;">// ************************************************************  </span>
 <span style="color: #75715e;">// IStep  </span>
 <span style="color: #75715e;">// ************************************************************  </span>
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">canStepInto</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #66d9ef;">false</span><span style="color: #f92672;">;</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">canStepOver</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #a6e22e;">isSuspended</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">canStepReturn</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #66d9ef;">false</span><span style="color: #f92672;">;</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">isStepping</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">getState</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">==</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">STEPPING</span><span style="color: #f92672;">);</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">stepInto</span><span style="color: #f92672;">()</span> <span style="color: #66d9ef;">throws</span> <span style="color: #f8f8f2;">DebugException</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">throw</span> <span style="color: #66d9ef;">new</span> <span style="color: #a6e22e;">DebugException</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">Status</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">IStatus</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">ERROR</span><span style="color: #f92672;">,</span> <span style="color: #e6db74;">"com.codeandme.textinterpreter.debugger"</span><span style="color: #f92672;">,</span> <span style="color: #e6db74;">"stepInto() not supported"</span><span style="color: #f92672;">));</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">stepOver</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #75715e;">// stepOver request from eclipse  </span>
  
  <span style="color: #75715e;">// send stepOver request to debugger  </span>
  <span style="color: #f8f8f2;">getDebugTarget</span><span style="color: #f92672;">().</span><span style="color: #a6e22e;">fireModelEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">STEP_OVER</span><span style="color: #f92672;">));</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">stepReturn</span><span style="color: #f92672;">()</span> <span style="color: #66d9ef;">throws</span> <span style="color: #f8f8f2;">DebugException</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">throw</span> <span style="color: #66d9ef;">new</span> <span style="color: #a6e22e;">DebugException</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">Status</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">IStatus</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">ERROR</span><span style="color: #f92672;">,</span> <span style="color: #e6db74;">"com.codeandme.textinterpreter.debugger"</span><span style="color: #f92672;">,</span> <span style="color: #e6db74;">"stepReturn() not supported"</span><span style="color: #f92672;">));</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
Необходимо упомянуть одну вещь, касаемую пошагового выполнения: отладочный фреймворк различает запросы на возобновление (resume request) и пошаговые запросы (step requests). Поэтому мы добавляем новое состояние дебаггера: <b>STEPPING</b>. Классу TextDebugger необходимо продолжать отслеживать тип возобновления (continue, step over, step into, step return) и отправлять соответствующие события обратно <b>DebugTarget</b>:<br />
<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #f92672;">package</span> <span style="color: #f8f8f2;">com</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">codeandme</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">textinterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">debugger</span><span style="color: #f92672;">;</span>  
  
<span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">class</span> <span style="color: #a6e22e;">TextDebugger</span> <span style="color: #66d9ef;">implements</span> <span style="color: #f8f8f2;">IDebugger</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IEventProcessor</span> <span style="color: #f92672;">{</span>  
  
 <span style="color: #75715e;">// FIXME for full source code see http://codeandme.googlecode.com/svn/trunk/blog/debugger/04/com.codeandme.textinterpreter.debugger/src/com/codeandme/textinterpreter/debugger/TextDebugger.java  </span>
  
 <span style="color: #66d9ef;">private</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #f8f8f2;">mIsStepping</span> <span style="color: #f92672;">=</span> <span style="color: #66d9ef;">false</span><span style="color: #f92672;">;</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">resumed</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">fireEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">ResumedEvent</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">mIsStepping</span> <span style="color: #f92672;">?</span> <span style="color: #f8f8f2;">ResumedEvent</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">STEPPING</span> <span style="color: #f92672;">:</span> <span style="color: #f8f8f2;">ResumedEvent</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">CONTINUE</span><span style="color: #f92672;">));</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">isBreakpoint</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #66d9ef;">int</span> <span style="color: #f8f8f2;">lineNumber</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #f8f8f2;">mIsStepping</span><span style="color: #f92672;">;</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IDebugEvent</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">System</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">out</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">println</span><span style="color: #f92672;">(</span><span style="color: #e6db74;">"Debugger.handleEvent() "</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
  
  <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
   <span style="color: #f8f8f2;">mIsStepping</span> <span style="color: #f92672;">=</span> <span style="color: #f92672;">(((</span><span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">)</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">).</span><span style="color: #a6e22e;">getType</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">==</span> <span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">STEP_OVER</span><span style="color: #f92672;">);</span>  
   <span style="color: #f8f8f2;">mInterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">resume</span><span style="color: #f92672;">();</span>  
  <span style="color: #f92672;">}</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
Классу <b>TextDebugTarget</b> в итоге необходимо запустить соответствующее событие для отладочного фреймворка:<br />
<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #f92672;">package</span> <span style="color: #f8f8f2;">com</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">codeandme</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">textinterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">model</span><span style="color: #f92672;">;</span>  
  
<span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">class</span> <span style="color: #a6e22e;">TextDebugTarget</span> <span style="color: #66d9ef;">extends</span> <span style="color: #f8f8f2;">TextDebugElement</span> <span style="color: #66d9ef;">implements</span> <span style="color: #f8f8f2;">IDebugTarget</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IEventProcessor</span> <span style="color: #f92672;">{</span>  
  
 <span style="color: #75715e;">// FIXME for full source code see http://codeandme.googlecode.com/svn/trunk/blog/debugger/04/com.codeandme.textinterpreter.debugger/src/com/codeandme/textinterpreter/debugger/model/TextDebugTarget.java  </span>
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IDebugEvent</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  
  <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(!</span><span style="color: #f8f8f2;">isDisconnected</span><span style="color: #f92672;">())</span> <span style="color: #f92672;">{</span>  
   <span style="color: #f8f8f2;">System</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">out</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">println</span><span style="color: #f92672;">(</span><span style="color: #e6db74;">"Target.handleEvent() "</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
  
   <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">ResumedEvent</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
    <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(((</span><span style="color: #f8f8f2;">ResumedEvent</span><span style="color: #f92672;">)</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">).</span><span style="color: #a6e22e;">getType</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">==</span> <span style="color: #f8f8f2;">ResumedEvent</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">STEPPING</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
     <span style="color: #f8f8f2;">setState</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">STEPPING</span><span style="color: #f92672;">);</span>  
     <span style="color: #f8f8f2;">fireResumeEvent</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">DebugEvent</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">STEP_OVER</span><span style="color: #f92672;">);</span>  
  
    <span style="color: #f92672;">}</span> <span style="color: #66d9ef;">else</span> <span style="color: #f92672;">{</span>  
     <span style="color: #f8f8f2;">setState</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">RESUMED</span><span style="color: #f92672;">);</span>  
     <span style="color: #f8f8f2;">fireResumeEvent</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">DebugEvent</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">UNSPECIFIED</span><span style="color: #f92672;">);</span>  
    <span style="color: #f92672;">}</span>  
   <span style="color: #f92672;">}</span>  
  <span style="color: #f92672;">}</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
В данный момент вы уже можете запустить отладчик в пошаговом режиме. Чтобы проверить результаты, посмотрите системный вывод в консоли.</div>


    </div>
    

    <div class="cleaner"></div>
</div>
<div class="psytronica_post_intro"></div>

<div class="psytronica_post odd  psy_post_sections">
    <h2><a href="./p/eclipse.html">3. Рассказ об отладчиках, процессах и потоках.</a></h2>

    <div class="date"><div class='psy_page_date'>02.11.2015</div></div>

    <div class="psytronica_post_content" >
        
<div dir="ltr" style="text-align: left;" trbidi="on">
<div style="text-aling: left;">
</div>
<div>
<div style="text-align: right;">
<i><a href="http://codeandme.blogspot.ru/2013/11/debugger-3-tale-of-debuggers-processes.html" target="_blank">Английский оригинал и исходный код</a></i></div>
<h3 style="text-align: left;">
Краткое объяснение сути отладочного фреймворка</h3>
<br /></div>
<div dir="ltr" style="text-align: left;" trbidi="on">
<div dir="ltr" style="text-align: left;" trbidi="on">
<div dir="ltr" style="text-align: left;" trbidi="on">
<div class="separator" style="clear: both; text-align: center;">
<a href="./images/eclipse/debugger/debug_vars.png" class="psy_img_up" imageanchor="1"  style="margin-left: 1em; margin-right: 1em;"><img border="0" height="280" src="./images/eclipse/debugger/debug_vars.png" width="320" /></a>


</div>
<div>
<br /></div>
Поскольку все отладчики отличаются друг от друга, отладочный фреймворк (<b>Debug Framework</b>) использует обобщенную модель взаимодействия с отладчиком. Главная точка входа в эту модель - <b>DebugTarget</b>. Она содержит одиночный процесс (<b>Process</b>), который может включать от одного до нескольких потоков. Так же она может быть реальной (напр., в случае внешнего отладчика) или виртуальной реализацией, если наш отладчик запущен в среде Эклипс.<br />
<br />
Когда потоки приостановлены, они могут предоставлять кадры стека (<b>StackFrames</b>), представляющие собой исполняемые единицы, как правило с отдельной областью видимости. В Java-отладке каждый экземпляр вызова стека представлен как кадр. Кадры стека (<b>StackFrames</b>) кроме того содержат отслеживание переменных.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="./images/eclipse/debugger/debug2.png" class="psy_img_up" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img  border="0" height="auto" src="./images/eclipse/debugger/debug2.png" width="90%" /></a></div>
<br />

<br />
Поскольку отладка вызывается событиями UI (<b>resume, step into, ...</b>), все взаимодействия между фреймворком и моделью следует обрабатывать в различных событиях обработки потоков. Эклипс в данном случае использует установку «запустили и забыли» («fire and forget»). Например, когда кто-то нажимает кнопку "возобновить", вызывается <b>IThread.resume()</b>, который должен немедленно вернуть результат. В фоновом режиме обработчик событий должен иметь возможность проинформировать отладчик о запросе на возобновление. В случае, если отладчик изменяет свое состояние на "возобновленный" ("resumed"), обработчик событий проинформирует нашу модель, которая обновит свое внутреннее представление и затем отправит событие во фреймворк.<br />
<br />
Раздельное использование событий немного сложно в применении, но необходимо для того, чтобы иметь возможность получать ответ от UI.<br />
<br />
Разделенное взаимодействие между моделью и отладчиком можно избежать, если отладчик запущен в среде Эклипс. Поскольку часто это не так, мы будем использовать события. Типичные существующие реализации могут использовать TCP-сообщение с внешним процессом.<br />
<h4 style="text-align: left;">

<br />

Шаг1. Добавляем поддержку отладки для лаунчеров</h4>
<br />
Когда мы создали расширения для запуска, мы разрешили только метод run. Для того, чтобы добавить цели запуска отладки откройте com.codeandme.textinterpreter.ui/plugin.xml и перейдите на вкладку "Расширения" (Extensions).<br />
<br />
<ul style="text-align: left;">
<li>Вначале перейдите в <b>launchConfigurationType</b> и установите методы - "<b>run,debug"</b>.&nbsp;</li>
<li>Затем откройте наш <b>launchConfigurationTabGroup</b> и добавьте новый метод запуска (launchMode). Здесь установите метод (mode) - "debug" и перспективу (perspective) - "<b>org.eclipse.debug.ui.DebugPerspective</b>".</li>
<li>В конце откройте launchShortcut и установите методы (modes) - "run,debug".</li>
</ul>
<br />
<br />
<h4 style="text-align: left;">
Шаг 2. Добавление реализации запуска</h4>
<br />
Откройте <b>TextLaunchDelegate.java</b> и замените метод launch следующим кодом:<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #66d9ef;">private</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">launch</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IFile</span> <span style="color: #f8f8f2;">file</span><span style="color: #f92672;">,</span> <span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">ILaunchConfiguration</span> <span style="color: #f8f8f2;">configuration</span><span style="color: #f92672;">,</span> <span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">String</span> <span style="color: #f8f8f2;">mode</span><span style="color: #f92672;">,</span> <span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">ILaunch</span> <span style="color: #f8f8f2;">launch</span><span style="color: #f92672;">,</span> <span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IProgressMonitor</span> <span style="color: #f8f8f2;">monitor</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
 <span style="color: #75715e;">// create new interpreter  </span>
 <span style="color: #f8f8f2;">TextInterpreter</span> <span style="color: #f8f8f2;">interpreter</span> <span style="color: #f92672;">=</span> <span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">TextInterpreter</span><span style="color: #f92672;">();</span>  
  
 <span style="color: #66d9ef;">try</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">ILaunchManager</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">DEBUG_MODE</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">equals</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">mode</span><span style="color: #f92672;">))</span> <span style="color: #f92672;">{</span>  
  
   <span style="color: #75715e;">// create debugger  </span>
   <span style="color: #f8f8f2;">TextDebugger</span> <span style="color: #f8f8f2;">debugger</span> <span style="color: #f92672;">=</span> <span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">TextDebugger</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">interpreter</span><span style="color: #f92672;">);</span>  
   <span style="color: #f8f8f2;">interpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">setDebugger</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">debugger</span><span style="color: #f92672;">);</span>  
  
   <span style="color: #75715e;">// create debugTarget  </span>
   <span style="color: #f8f8f2;">TextDebugTarget</span> <span style="color: #f8f8f2;">debugTarget</span> <span style="color: #f92672;">=</span> <span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">TextDebugTarget</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">launch</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">file</span><span style="color: #f92672;">);</span>  
  
   <span style="color: #75715e;">// create &amp; launch dispatcher  </span>
   <span style="color: #f8f8f2;">EventDispatchJob</span> <span style="color: #f8f8f2;">dispatcher</span> <span style="color: #f92672;">=</span> <span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">EventDispatchJob</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">debugTarget</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">debugger</span><span style="color: #f92672;">);</span>  
   <span style="color: #f8f8f2;">dispatcher</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">schedule</span><span style="color: #f92672;">();</span>  
  
   <span style="color: #75715e;">// attach dispatcher to debugger &amp; debugTarget  </span>
   <span style="color: #f8f8f2;">debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">setEventDispatcher</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">dispatcher</span><span style="color: #f92672;">);</span>  
   <span style="color: #f8f8f2;">debugTarget</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">setEventDispatcher</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">dispatcher</span><span style="color: #f92672;">);</span>  
  
   <span style="color: #75715e;">// add debug target to launch  </span>
   <span style="color: #f8f8f2;">launch</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">addDebugTarget</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">debugTarget</span><span style="color: #f92672;">);</span>  
  <span style="color: #f92672;">}</span>  
  
  <span style="color: #f8f8f2;">interpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">setCode</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">toString</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">file</span><span style="color: #f92672;">));</span>  
  <span style="color: #f8f8f2;">interpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">schedule</span><span style="color: #f92672;">();</span>  
  
 <span style="color: #f92672;">}</span> <span style="color: #66d9ef;">catch</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">Exception</span> <span style="color: #f8f8f2;">e</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #75715e;">// TODO handle this exception (but for now, at least know it  </span>
  <span style="color: #75715e;">// happened)  </span>
  <span style="color: #66d9ef;">throw</span> <span style="color: #66d9ef;">new</span> <span style="color: #a6e22e;">RuntimeException</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">e</span><span style="color: #f92672;">);</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
Основные компоненты, которые нам нужны:<br />
<br />
<ul style="text-align: left;">
<li>Реализация отладчика (строки 9-10)</li>
</ul>
<br />
Отладчик привязан к нашему интерпретатору и управляет всеми отладочными взаимодействиями на клиентской стороне.<br />
<br />
<ul style="text-align: left;">
<li>DebugTarget (строка 13)</li>
</ul>
<br />
<b>DebugTarget</b> является представителем нашего отладчика на стороне Эклипса. Когда отладочному фреймворку эклипса необходимо взаимодействовать с нашим отладчиком, он вызывает <b>DebugTarget</b> для обработки запроса.<br />
<br />
<ul style="text-align: left;">
<li>Диспетчер асинхронных событий (16-17)</li>
</ul>
<br />
Поскольку запросы, осуществляемые отладчиком Эклипса (такие как<b> resume, step over</b>, ...) происходят из UI, они должны обрабатываться асинхронно. Таким образом, диспетчер событий обрабатывает эти запросы в их собственных потоках.<br />
<br />
<h4 style="text-align: left;">
Шаг 3. Отладчик</h4>
<br />
Для всего, что непосредственно касается отладки мы будем использовать новый плагин, называемый <b>com.codeandme.textinterpreter.debugger.</b><br />
<br />
<b>TextDebugger</b> осуществляет интерфейс <b>IDebugger</b> из нашего интерпретатора и интерфейс <b>IEventProcessor</b>, чтобы обрабатывать события, полученные из <b>EventDispatcher</b>. Реализация обозначена с левой стороны блок-схемы, которая представлена выше. Давайте посмотрим на важные части кода:<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #f92672;">package</span> <span style="color: #f8f8f2;">com</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">codeandme</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">textinterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">debugger</span><span style="color: #f92672;">;</span>  
  
<span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">class</span> <span style="color: #a6e22e;">TextDebugger</span> <span style="color: #66d9ef;">implements</span> <span style="color: #f8f8f2;">IDebugger</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IEventProcessor</span> <span style="color: #f92672;">{</span>  
  
 <span style="color: #75715e;">// FIXME for full source code see http://codeandme.googlecode.com/svn/trunk/blog/debugger/03/com.codeandme.textinterpreter.debugger/src/com/codeandme/textinterpreter/debugger/TextDebugger.java  </span>
  
 <span style="color: #66d9ef;">private</span> <span style="color: #f8f8f2;">EventDispatchJob</span> <span style="color: #f8f8f2;">mDispatcher</span><span style="color: #f92672;">;</span>  
 <span style="color: #66d9ef;">private</span> <span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">TextInterpreter</span> <span style="color: #f8f8f2;">mInterpreter</span><span style="color: #f92672;">;</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">loaded</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">fireEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">DebuggerStartedEvent</span><span style="color: #f92672;">());</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">resumed</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">fireEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">ResumedEvent</span><span style="color: #f92672;">());</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">terminated</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">fireEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">TerminatedEvent</span><span style="color: #f92672;">());</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IDebugEvent</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">System</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">out</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">println</span><span style="color: #f92672;">(</span><span style="color: #e6db74;">"Debugger.handleEvent() "</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
  
  <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">ResumeEvent</span><span style="color: #f92672;">)</span>  
   <span style="color: #f8f8f2;">mInterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">resume</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #66d9ef;">private</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">fireEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IDebugEvent</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">System</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">out</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">println</span><span style="color: #f92672;">(</span><span style="color: #e6db74;">"Debugger.fireEvent() "</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
  
  <span style="color: #f8f8f2;">mDispatcher</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">addEvent</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
Мы можем видеть, что события срабатывают, когда наш интерпретатор изменяет свое состояние (<b>loaded(), resumed(), terminated()</b>). Отладчик всего лишь передает их диспетчеру. Событие loaded это особый случай события resumed: оно сообщает нашей модели, что установлен новый интерпретатор и что исходник уже загружен для обработки. Это позволяет модели устанавливать точки останова до того, как интерпретатор начитает выполнять код.<br />
<br />
Когда модель посылает события отладчику, диспетчер вызывает <b>handleEvent</b>(). В нашем случае, мы всего лишь разрешаем возобновление (что необходимо после события loaded, которое автоматически приостанавливает интерпретатор)<br />
<br />
<h4 style="text-align: left;">
Шаг 4. Модель</h4>
<br />
Давайте начнем с класса <b>TextDebugTarget</b>, поскольку это наша главная точка входа в модель. Снова рассмотрим только наиболее важные части.<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #f92672;">package</span> <span style="color: #f8f8f2;">com</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">codeandme</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">textinterpreter</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">model</span><span style="color: #f92672;">;</span>  
  
<span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">class</span> <span style="color: #a6e22e;">TextDebugTarget</span> <span style="color: #66d9ef;">extends</span> <span style="color: #f8f8f2;">TextDebugElement</span> <span style="color: #66d9ef;">implements</span> <span style="color: #f8f8f2;">IDebugTarget</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IEventProcessor</span> <span style="color: #f92672;">{</span>  
  
 <span style="color: #75715e;">// FIXME for full source code see http://codeandme.googlecode.com/svn/trunk/blog/debugger/03/com.codeandme.textinterpreter.debugger/src/com/codeandme/textinterpreter/debugger/model/TextDebugTarget.java   </span>
  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">enum</span> <span style="color: #f8f8f2;">State</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">NOT_STARTED</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">SUSPENDED</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">RESUMED</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">TERMINATED</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">DISCONNECTED</span>  
 <span style="color: #f92672;">};</span>  
  
 <span style="color: #66d9ef;">private</span> <span style="color: #f8f8f2;">EventDispatchJob</span> <span style="color: #f8f8f2;">mDispatcher</span><span style="color: #f92672;">;</span>  
  
 <span style="color: #66d9ef;">private</span> <span style="color: #f8f8f2;">State</span> <span style="color: #f8f8f2;">mState</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">NOT_STARTED</span><span style="color: #f92672;">;</span>  
  
 <span style="color: #66d9ef;">private</span> <span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IFile</span> <span style="color: #f8f8f2;">mFile</span><span style="color: #f92672;">;</span>  
  
 <span style="color: #66d9ef;">public</span> <span style="color: #a6e22e;">TextDebugTarget</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">ILaunch</span> <span style="color: #f8f8f2;">launch</span><span style="color: #f92672;">,</span> <span style="color: #f8f8f2;">IFile</span> <span style="color: #f8f8f2;">file</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">super</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">null</span><span style="color: #f92672;">);</span>  
  
  <span style="color: #f8f8f2;">fireCreationEvent</span><span style="color: #f92672;">();</span>  
  
  <span style="color: #75715e;">// create a process  </span>
  <span style="color: #f8f8f2;">mProcess</span> <span style="color: #f92672;">=</span> <span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">TextProcess</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">this</span><span style="color: #f92672;">);</span>  
  <span style="color: #f8f8f2;">mProcess</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">fireCreationEvent</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">fireModelEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IDebugEvent</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  <span style="color: #f8f8f2;">System</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">out</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">println</span><span style="color: #f92672;">(</span><span style="color: #e6db74;">"Target.fireEvent() "</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
  
  <span style="color: #f8f8f2;">mDispatcher</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">addEvent</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">final</span> <span style="color: #f8f8f2;">IDebugEvent</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
  
  <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(!</span><span style="color: #f8f8f2;">isDisconnected</span><span style="color: #f92672;">())</span> <span style="color: #f92672;">{</span>  
   <span style="color: #f8f8f2;">System</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">out</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">println</span><span style="color: #f92672;">(</span><span style="color: #e6db74;">"Target.handleEvent() "</span> <span style="color: #f92672;">+</span> <span style="color: #f8f8f2;">event</span><span style="color: #f92672;">);</span>  
  
   <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">DebuggerStartedEvent</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
    <span style="color: #75715e;">// create debug thread  </span>
    <span style="color: #f8f8f2;">TextThread</span> <span style="color: #f8f8f2;">thread</span> <span style="color: #f92672;">=</span> <span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">TextThread</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">this</span><span style="color: #f92672;">);</span>  
    <span style="color: #f8f8f2;">mThreads</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">add</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">thread</span><span style="color: #f92672;">);</span>  
    <span style="color: #f8f8f2;">thread</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">fireCreationEvent</span><span style="color: #f92672;">();</span>  
  
    <span style="color: #75715e;">// debugger got started and waits in suspended mode  </span>
    <span style="color: #f8f8f2;">mState</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">SUSPENDED</span><span style="color: #f92672;">;</span>  
  
    <span style="color: #75715e;">// inform eclipse of suspended state  </span>
    <span style="color: #f8f8f2;">fireSuspendEvent</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">DebugEvent</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">CLIENT_REQUEST</span><span style="color: #f92672;">);</span>  
  
   <span style="color: #f92672;">}</span> <span style="color: #66d9ef;">else</span> <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">ResumedEvent</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
    <span style="color: #f8f8f2;">mState</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">RESUMED</span><span style="color: #f92672;">;</span>  
  
    <span style="color: #75715e;">// inform eclipse of resumed state  </span>
    <span style="color: #f8f8f2;">fireResumeEvent</span><span style="color: #f92672;">(</span><span style="color: #f8f8f2;">DebugEvent</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">UNSPECIFIED</span><span style="color: #f92672;">);</span>  
  
   <span style="color: #f92672;">}</span> <span style="color: #66d9ef;">else</span> <span style="color: #66d9ef;">if</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">event</span> <span style="color: #66d9ef;">instanceof</span> <span style="color: #f8f8f2;">TerminatedEvent</span><span style="color: #f92672;">)</span> <span style="color: #f92672;">{</span>  
    <span style="color: #75715e;">// debugger is terminated  </span>
    <span style="color: #f8f8f2;">mState</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">TERMINATED</span><span style="color: #f92672;">;</span>  
  
    <span style="color: #75715e;">// we do not need our dispatcher anymore  </span>
    <span style="color: #f8f8f2;">mDispatcher</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">terminate</span><span style="color: #f92672;">();</span>  
  
    <span style="color: #75715e;">// inform eclipse of terminated state  </span>
    <span style="color: #f8f8f2;">fireTerminateEvent</span><span style="color: #f92672;">();</span>  
   <span style="color: #f92672;">}</span>  
  <span style="color: #f92672;">}</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #f8f8f2;">String</span> <span style="color: #a6e22e;">getName</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #e6db74;">"Text DebugTarget"</span><span style="color: #f92672;">;</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #75715e;">// ************************************************************  </span>
 <span style="color: #75715e;">// ISuspendResume  </span>
 <span style="color: #75715e;">// ************************************************************  </span>
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">canResume</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #a6e22e;">isSuspended</span><span style="color: #f92672;">();</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">boolean</span> <span style="color: #a6e22e;">isSuspended</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #66d9ef;">return</span> <span style="color: #f92672;">(</span><span style="color: #f8f8f2;">mState</span> <span style="color: #f92672;">==</span> <span style="color: #f8f8f2;">State</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">SUSPENDED</span><span style="color: #f92672;">);</span>  
 <span style="color: #f92672;">}</span>  
  
 <span style="color: #a6e22e;">@Override</span>  
 <span style="color: #66d9ef;">public</span> <span style="color: #66d9ef;">void</span> <span style="color: #a6e22e;">resume</span><span style="color: #f92672;">()</span> <span style="color: #f92672;">{</span>  
  <span style="color: #75715e;">// resume request from eclipse  </span>
  
  <span style="color: #75715e;">// send resume request to debugger  </span>
  <span style="color: #f8f8f2;">fireModelEvent</span><span style="color: #f92672;">(</span><span style="color: #66d9ef;">new</span> <span style="color: #f8f8f2;">ResumeRequest</span><span style="color: #f92672;">());</span>  
 <span style="color: #f92672;">}</span>  
<span style="color: #f92672;">}</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
Эклипс предоставляет прекрасный базовый класс для всех частей модели: <b>DebugElement</b>. Мы добавляем наш собственный базовый класс <b>TextDebugElement</b>. Прямо сейчас он ничего не делает, но он нам понадобится в следующей части руководства.<br />
<br />
Первое, что мы видим, это то, что модели необходимо отслеживание состояния отладчика (строка 13, 46, 52, ...). Это необходимо, чтобы разрешить/запретить опции отладки на панели инструментов.<br />
<br />
В конструкторе мы запускаем событие создания (строка 20). Это событие отправляется отладочному фреймворку Эклипса и может запустить UI взаимодействия (такое как переключение в отладочную перспективу). После этого мы создаем процесс и снова запускаем для этого событие создания. Мы будем видеть эту структуру все время, пока взаимодействуем с фреймворком. Когда нам кажется, что изменилось что-то важное, нам нужно поставить в известность фреймворк о произошедшем изменении посредством отправки события. Других способов взаимодействия с нашей моделью нет.<br />
<br />
<b>handleEvent</b>() это аналог <b>TextDebugger.handleEvent</b>(). В событии <b>DebuggerStartedEvent</b> мы создаем новый поток, настраиваем нашу модель состояний и сообщаем Эклипсу, что отладчик находится в приостановленном состоянии. Тогда Эклипс активирует для нас кнопку панели инструментов "resume" (возобновление). Когда наступает событие <b>TerminateEvent</b>, нам необходимо отключить планировщик, иначе он будет работать все время.<br />
<br />
До того, как Эклипс активирует кнопку возобновления (как описано выше), он запрашивает нашу модель, посылая <b>canResume</b>(). Мы только позволяем Эклипсу возобновление, когда отладчик временно приостановлен. Затем resume() запускает новое событие, которое отправляется диспетчеру и в конечном итоге обрабатывается отладчиком.<br />
<br />
<h4 style="text-align: left;">
Шаг 5. Запуск отладчика</h4>
<br />
Я покажу часть кода системного вывода, чтобы проследить все события, которые передаются между моделью и отладчиком. Когда вы запускаете отладчик, вы должны увидеть следующий вывод:<br />
<!-- HTML generated using hilite.me --><br />
<div style="background: #272822; border-width: .1em .1em .1em .8em; border: solid gray; overflow: auto; padding: .2em .6em; width: auto;">
<table><tbody>
<tr><td><pre style="line-height: 125%; margin: 0;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre>
</td><td><pre style="line-height: 125%; margin: 0;"><span style="color: #f8f8f2;">Debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">fireEvent</span><span style="color: #f92672;">()</span> <span style="color: #f8f8f2;">DebuggerStartedEvent</span>  
<span style="color: #f8f8f2;">Target</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">()</span> <span style="color: #f8f8f2;">DebuggerStartedEvent</span>  
<span style="color: #f8f8f2;">Target</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">fireEvent</span><span style="color: #f92672;">()</span> <span style="color: #f8f8f2;">ResumeRequest</span>  
<span style="color: #f8f8f2;">Debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">()</span> <span style="color: #f8f8f2;">ResumeRequest</span>  
<span style="color: #f8f8f2;">Debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">fireEvent</span><span style="color: #f92672;">()</span> <span style="color: #f8f8f2;">ResumedEvent</span>  
<span style="color: #f8f8f2;">Target</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">()</span> <span style="color: #f8f8f2;">ResumedEvent</span>  
<span style="color: #f92672;">&gt;&gt;&gt;</span> <span style="color: #f8f8f2;">hello</span> <span style="color: #f8f8f2;">world</span> <span style="color: #f92672;">&lt;&lt;&lt;</span>  
<span style="color: #f92672;">&gt;&gt;&gt;</span> <span style="color: #f8f8f2;">first</span> <span style="color: #f8f8f2;">name</span> <span style="color: #f92672;">=</span> <span style="color: #f8f8f2;">Christian</span> <span style="color: #f92672;">&lt;&lt;&lt;</span>  
<span style="color: #f92672;">&gt;&gt;&gt;</span> <span style="color: #f8f8f2;">we</span> <span style="color: #f8f8f2;">just</span> <span style="color: #f8f8f2;">defined</span> <span style="color: #f8f8f2;">a</span> <span style="color: #f8f8f2;">variable</span> <span style="color: #f92672;">&lt;&lt;&lt;</span>  
<span style="color: #f92672;">&gt;&gt;&gt;</span>  <span style="color: #f92672;">&lt;&lt;&lt;</span>  
<span style="color: #f92672;">&gt;&gt;&gt;</span> <span style="color: #f8f8f2;">counter</span> <span style="color: #f92672;">=</span> <span style="color: #ae81ff;">23</span> <span style="color: #f92672;">&lt;&lt;&lt;</span>  
<span style="color: #f92672;">&gt;&gt;&gt;</span>  <span style="color: #f92672;">&lt;&lt;&lt;</span>  
<span style="color: #f92672;">&gt;&gt;&gt;</span> <span style="color: #f8f8f2;">we</span> <span style="color: #f8f8f2;">are</span> <span style="color: #f8f8f2;">running</span> <span style="color: #f92672;">&lt;&lt;&lt;</span>  
<span style="color: #f92672;">&gt;&gt;&gt;</span> <span style="color: #f8f8f2;">our</span> <span style="color: #f8f8f2;">interpreter</span> <span style="color: #f92672;">&lt;&lt;&lt;</span>  
<span style="color: #f8f8f2;">Debugger</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">fireEvent</span><span style="color: #f92672;">()</span> <span style="color: #f8f8f2;">TerminatedEvent</span>  
<span style="color: #f8f8f2;">Target</span><span style="color: #f92672;">.</span><span style="color: #a6e22e;">handleEvent</span><span style="color: #f92672;">()</span> <span style="color: #f8f8f2;">TerminatedEvent</span>  
</pre>
</td></tr>
</tbody></table>
</div>
<br />
После того, как мы получили событие <b>DebuggerStartedEvent</b>, наш отладчик приостанавливается и ожидает событие возобновления, вызванное Эклипсом. Чтобы в этом убедиться, нажмите на кнопку возобновления, чтобы продолжить исполнение программы.</div>
</div>
</div>
</div>


    </div>
    

    <div class="cleaner"></div>
</div>
<div class="psytronica_post_intro"></div>

</div>


            </div>
            <div id="psytronica_right_column">
                <div id="psytronica_right_column_inset">
                    <div id="psytronica_right_column_inner">
                      <div id="psytronica_right_column_innering">
                        
<h5>Облако тегов</h5>
<div class='psy_tags2'><a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/cke.html'>cke<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='4' style='font-size:14px; color:rgba(255, 163, 80, 1)' href='./search/label/eclipse.html'>eclipse<span>&nbsp;(4)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/filemanager.html'>filemanager<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/inno.html'>inno<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/jlnodoubles.html'>jlnodoubles<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='8' style='font-size:20px; color:rgba(255, 221, 173, 1)' href='./search/label/joomla.html'>joomla<span>&nbsp;(8)</span></a> <a class='psy_tag_calc_link' tagcount='2' style='font-size:11px; color:rgba(255, 111, 73, 1)' href='./search/label/joomshopping.html'>joomshopping<span>&nbsp;(2)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/php.html'>php<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='4' style='font-size:14px; color:rgba(255, 163, 80, 1)' href='./search/label/plug-in_development.html'>plug-in development<span>&nbsp;(4)</span></a>  <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/shnodoubles.html'>shnodoubles<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/tiddlyWiki.html'>tiddlyWiki<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/ubuntu.html'>ubuntu<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='4' style='font-size:14px; color:rgba(255, 163, 80, 1)' href='./search/label/zygo_profile.html'>zygo_profile<span>&nbsp;(4)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/друзья.html'>друзья<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='4' style='font-size:14px; color:rgba(255, 163, 80, 1)' href='./search/label/разработки.html'>разработки<span>&nbsp;(4)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/санскрит.html'>санскрит<span>&nbsp;(1)</span></a> </div>
 
<h5>Меню</h5>
<ul class="psy_right_menu">
<li><a href='./#blog' class='psy_noactive'>Главная</a></li>
<li><span class='psy_active'>Создание собственного отладчика в Eclipse</span></li>
<li><a href='./section/санскрит.html' class='psy_noactive'>Санскрит - немножко перевожу</a></li>
<li><a href='./section/camino_latino.html' class='psy_noactive'>Camino Latino - истории о латинской америке</a></li>
</ul>
<h5>Архив</h5>
<div class='psy_archive'>
    <div class='psy_archive_elems' style='display:none'>
            <span class='el_open'>&#9660;&#160;</span>
            <span class='el_closed'>&#9658;&#160;</span>
    </div>
    <ul class='psy_archive_years'><li class='last_year' >
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-open'>&#9660;&#160;</span>
                    </a>
                    <a class='psy_year_title' href='#'>2017</a><ul class='psy_archive_mons'><li class='last_month' >
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-open'>&#9660;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>03</a><ul class='psy_archive_days'><li><a href='./2017/03/eclipse-wizard-open-programmatically.html'>Вызов wizard'а в Eclipse по кнопке или по shortcut'y в меню</a></li><li><a href='./2017/03/eclipse-custom-project-nature-icons.html'>Eclipse: особые иконки в Project Explorer для проекта с определенной Nature</a></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>02</a><ul class='psy_archive_days'><li><a href='./2017/02/joomshopping-list-to-text-attribute.html'>Joomshopping - замена выпадающих списков с единственным элементом на текст в независимых атрибутах</a></li><li><a href='./2017/02/cke-joomla3-problem.html'>Фикс: проблема с CKE-редактором под Joomla 3</a></li><li><a href='./2017/02/zygo-profile-autoupdates-webcam.html'>Новый релиз Zygo Profile: автообновления, камера, поддержка Joomla 3.7</a></li><li><a href='./2017/02/Zygo-Joomshopping-Review-Captcha.html'>Zygo Joomshopping Review Captcha - капча KCaptcha для отзывов в интернет-магазине Joomshopping</a></li><li><a href='./2017/02/svetomaster_video.html'>Подарок от Евгения</a></li><li><a href='./2017/02/inno-recursive-file-copy-timestamps.html'>Inno - создание инсталлятора. Рекурсивное копирование файлов внешней директории, учитывая даты.</a></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>01</a><ul class='psy_archive_days'><li><a href='./2017/01/tiddlywiki-php7-last-backups-store.html'>TiddlyWiki: сохранение 10 последних резервных копий на сервере.</a></li></ul></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_year_title' href='#'>2016</a><ul class='psy_archive_mons'><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>11</a><ul class='psy_archive_days'><li><a href='./2016/11/zygoprofile-checkbox-checkboxes-html_88.html'>ZygoProfile: добавлены поля checkbox, checkboxes, html</a></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>10</a><ul class='psy_archive_days'><li><a href='./2016/10/zygoprofile.html'>ZygoProfile - назначение полей группам пользователей.</a></li><li><a href='./2016/10/shabdatra.html'>Санскрит -  запоминание глагольных форм</a></li></ul></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_year_title' href='#'>2015</a><ul class='psy_archive_mons'><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>10</a><ul class='psy_archive_days'><li><a href='./2015/10/joomla-3x-zygoprofile-hkmprofile.html'>Плагин расширенного профиля Joomla 3.x с поддержкой аватаров (обработка имиджей, обрезка миниатюр) - Zygo Profile</a></li><li><a href='./2015/10/eclipse-ivaluevariable-idynamicvariable.html'>Переменные в плагинах Eclipse. Интерфейсы IValueVariable и IDynamicVariable</a></li><li><a href='./2015/10/verbos-irregulares-android-kivy-python.html'>Verbos irregulares - приложение для android для запоминания неправильных испанских глаголов.</a></li><li><a href='./2015/10/eclipse-ubuntu-linux.html'>Открыть ресурс в файловом менеджере - плагин для Eclipse под Ubuntu Linux.</a></li></li></ul></li></ul></div>

                      </div>
                    </div>
                    <div id="psytronica_right_column_inner_after"></div>
                </div>

            </div>
          	<div class="cleaner"></div>
        </div>
        <div id="psy_after_main"></div>
        <div class='psy_pagination'><a class='psy_page_first' href='./section/Создание_собственного_отладчика_в_Eclipse.html'><span> &lt;&lt; </span></a><a class='psy_page_prev' href='./section/Создание_собственного_отладчика_в_Eclipse.html'><span> &lt; </span></a><a class='psy_page_other' href='./section/Создание_собственного_отладчика_в_Eclipse.html'><span>1</span></a><span class='psy_page_cur' ><span>2</span></span><span class='psy_page_next'><span> &gt; </span></span><span class='psy_page_end'><span> &gt;&gt; </span></span><div class='clearfix'></div></div>
    </div>
</div>

<div class="cleaner"></div>



<div id="psytronica_cr_bar_wrapper">
	<div id="psytronica_cr_bar">
    	
© Psytronica.ru. Блог существа SherZa. 2015-2017

        <a href="#top" class="to_anchor">Наверх</a>
    </div>
</div>


<div id="dsq-count-scr-wrapper"></div>



  

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
  $(document).ready(function(){

    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter33338883 = new Ya.Metrika({
                    id:33338883,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
  });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/33338883" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->


<script>
  $(document).ready(function(){
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-91608488-1', 'auto');
  ga('send', 'pageview');
  });
</script>

</div>  
 <style>
   body{
   	background: #2d261a;
   }
   body #psy_body_inner{
		opacity:1;
    } 
  </style> 
</body>
</html>

