
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

    <base href="./" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Web-разработка, PHP, Javascript, jQuery, Joomla" />
    <meta name="rights" content="teafortwo.ru" />
    <meta name="description" content="разработка плагинов для Eclipse, Web-разработка, разработка расширений для joomla, программные разработки для изучения иностранных языков" />
    <meta name="generator" content="Psytronica.ru" />
    <meta content='IE=edge' http-equiv='X-UA-Compatible'/>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>
	<meta name="yandex-verification" content="70dcadaa2851af41" />
	<link href="./yinyang.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />

    <title>Psytronica.ru - Web-разработка, инстранные языки, Eclipse и разные разности</title>
    <link rel="stylesheet" href="./css/psytronica1.css" type="text/css" media="screen" /> 
    <script src="./js/psytronica2.js" type="text/javascript"></script>




</head>
<body id='psy_body_page2' onload="setBodyWidth();">
<div id="psy_body_inner">

<div id="psytronica_menu_wrapper">
    <div id="psytronica_menu" class="ddsmoothmenu">


        <ul>
            <li><a href='./index.html' class='psy_noactive'>Главная</a></li>
            <li><a href='./search/label/разработки.html' class='psy_noactive'>Мои разработки</a>
            </li>
          <li><a href='./me.html' class='psy_noactive'>Контакты</a></li>
        </ul>



	<div id="psytronica_search" class='psy_search_div'>
		  <input type="text" id='psy_search'  title="keyword" placeholder="Поиск..."/>
		  <div id='psy_search_results'></div>
	</div>

        <br style="clear: left" />
    </div> <!-- end of psytronica_menu -->
</div> <!-- end of psytronica_menu_wrapper -->


<div id="psytronica_header_wrapper" class="psytronica_header_other">
    <div id="psytronica_header" class="header_home">
        
<div id="psytronica_sitetitle_bar">
    <div id="site_title"><h1><a href='./index.html' class='psy_noactive'>Psytronica</a></h1></div>

    <div id="mid_title">
        Web-разработка, иностранные языки, Eclipse  и разные разности
    </div>
    <div class="cleaner"></div>
</div>

        

    </div> <!-- end of header -->
</div> <!-- end of header_wrapper -->


<div id="psytronica_after_header">

            <h3><a href='./2015/10/joomla-3x-zygoprofile-hkmprofile.html' class='psy_noactive'>Zygo Profile</a></h3>
            <h3><a href='./2016/10/shabdatra.html' class='psy_noactive'>Санскрит - словоформы</a></h3>
            <h3><a href='./2015/10/verbos-irregulares-android-kivy-python.html' class='psy_noactive'>Verbos Irregulares</a></h3>

</div>







<a name="blog"></a>

<div id="psytronica_main_wrapper">

    <div id="psytronica_main_inner">
        <div id="psytronica_main">
            <div id="psytronica_content_area">

                 
<div id="psytronica_blog">

<div class="psytronica_post odd psy_post_blogpost">
    <h2><a href="./2017/02/Zygo-Joomshopping-Review-Captcha.html">Zygo Joomshopping Review Captcha - капча KCaptcha для отзывов в интернет-магазине Joomshopping</a></h2>

    <div class="date"><div class='psy_page_date'>11.02.2017</div></div>

    <div class="psytronica_post_content" >
        
<a href="./images/zygo_jsreview_captcha/1.png" title="Zygo Joomshopping Review Captcha - фронтэнд" class="psy_img_up">
<img align="left" style="width:150px; margin-right:20px;" src="./images/zygo_jsreview_captcha/1.png" />
</a>Недавно сделала для одного из моих проектов плагин, который позволяет добавлять капчу KCaptcha к отзывам магазина Joomshopping. Сейчас хочу поделиться с вами наработками.
<br /><br />
KCaptcha используется в разных полезных расширениях, в том числе, в jComments. Эта капча не относится к откровенно издевательским капчам, в которых тест Тьюринга не пройдет даже простой смертный.
<div class="clearfix"></div><br />
<div class="zecode">

 <a href="https://github.com/psytronica/Zygo-Joomshopping-Review-Captcha/archive/master.zip"><img class="img_plain" src="./images/template/archive.png" style="vertical-align: middle; width: 30px;" />&nbsp; Скачать</a> Zygo Joomshopping Review Captcha
  
<div style=" clear:both; border-top: 1px dashed #634b30; margin-top:10px; padding-top:10px;">
<b><a href="http://psytronica.getenjoyment.net/index.php/magazin/water/water-15l"><img border="0" class="img_white" src="./images/template/demo2.png" style="height: 34px; vertical-align: middle;" />&nbsp; Демо - сайт </a></b> с установленным расширением </div>

</div>
  
<br />
В админ-панели достаточное количество настроек, которыми можно варьировать:

    </div>
    <span class='readmore'><a class='psy_readmore' href='./2017/02/Zygo-Joomshopping-Review-Captcha.html'>Дальше >></a></span>

    <div class='psy_page_tags'><ul class='tags'><li><a href='./search/label/joomla.html'>joomla <span>8</span></a></li> <li class='blue' ><a href='./search/label/разработки.html'>разработки <span>4</span></a></li> <li><a href='./search/label/joomshopping.html'>joomshopping <span>2</span></a></li> </ul></div>
 
<a class="psy_blog_comment_link" href="./2017/02/Zygo-Joomshopping-Review-Captcha.html#disqus_thread"></a>


    <div class="cleaner"></div>
</div>
<div class="psytronica_post_intro"></div>

<div class="psytronica_post even psy_post_blogpost">
    <h2><a href="./2017/02/svetomaster_video.html">Подарок от Евгения</a></h2>

    <div class="date"><div class='psy_page_date'>04.02.2017</div></div>

    <div class="psytronica_post_content" >
        
Сегодня мне один очень хороший человек по имени <b>Евгений</b> сделал анимированный подарок.
<br /><br />
<div id="zhendox_video"><img class="imgplain" id="zhendox_video_img" style="width:100%"; src="./video/Psytronica.jpg" onclick="zhendox_video_go(this)"></div>
<br /><br />
Помимо того, что Евгений хороший человек, он еще и прекрасный специалист, великолепно владеет autoCAD'ом, а какое-то время назад открыл для себя новое направление и теперь занимается <a rel="nofollow" href="http://светомастер.рф">светодиодными экранами</a> и разными другими интересными вещами.
<br /><br />
Все началось с того, что несколько лет назад Евгений установил плагин <b>Shnodoubles</b> для уничтожения дублей под cms <b>Joomla</b>, который я тогда написала. Ни для кого не секрет, что cms Joomla позволяет доступиться к одной и той же странице по бесконечному числу ссылок. 
<br /><br />
Пример таких ссылок:
<br />
<div class="zecode">
<ol>
<li>http://сайт/my_cat/my_page.html</li>
<li>http://сайт/my_cat/my_page</li>
<li>http://сайт/index.php?option=com_content&view=article&id=5:my_page&Itemid=10</li>
<li>http://сайт/index.php?option=com_content&view=article&id=5</li>
</ol>
</div>

<br />
Суть плагина состояла в том, что он вычислял единственную верную ссылку на нужную страницу и перенаправлял с остальных неверных. Рассмотрим это на нашем примере: пусть правильно сформированная ссылка будет ссылка <b>1</b>. Тогда при переходе по ссылкам 2, 3 или 4 плагин будет автоматически перенаправлять посетителя на ссылку 1 (301 редирект).
<br /><br />
Два года назад я передала этот плагин студии <b>JoomLine</b>, все это время они его развивают, выпускают новые версии. Теперь плагин называется <b>JL No Doubles</b>.
<br /><br />
<div style="text-align:center">
<a href="http://joomline.org/extensions/scripts-other-developments/jlnodoubles.html" rel="nofollow" class="btn">Скачать JL No Doubles</a>
 </div>
<br />
Студией JoomLine руководит очень отвественный человек - <b>Вадим Куницин</b>, все их расширения, с которыми я имела дело, оставили у меня самое приятное впечатление.
<br /><br />
<script>
  function zhendox_video_go(self){
  	self.src = './video/Psytronica.gif';
  }
 </script>


    </div>
    

    <div class='psy_page_tags'><ul class='tags'><li class='blue' ><a href='./search/label/друзья.html'>друзья <span>1</span></a></li> <li class='green' ><a href='./search/label/shnodoubles.html'>shnodoubles <span>1</span></a></li> <li><a href='./search/label/jlnodoubles.html'>jlnodoubles <span>1</span></a></li> <li><a href='./search/label/joomla.html'>joomla <span>8</span></a></li> </ul></div>
 
<a class="psy_blog_comment_link" href="./2017/02/svetomaster_video.html#disqus_thread"></a>


    <div class="cleaner"></div>
</div>
<div class="psytronica_post_intro"></div>

<div class="psytronica_post odd psy_post_blogpost">
    <h2><a href="./2017/02/inno-recursive-file-copy-timestamps.html">Inno - создание инсталлятора. Рекурсивное копирование файлов внешней директории, учитывая даты.</a></h2>

    <div class="date"><div class='psy_page_date'>02.02.2017</div></div>

    <div class="psytronica_post_content" >
        
<img align="left" src="./images/inno/inno_logo.png" class="imgplain">У меня появилась задачка - сделать инсталлятор для программы Windows, причем в качестве основы взять один из свободно распространяемых GUI-инсталляторов. Инсталлятор мой должен был выполнять не совсем обычный функционал - копировать файлы из уже существующих директорий, вызывать некоторые другие программы на разных этапах установки, даже делать несложные расчеты. Пересмотрела я много чего и поняла, что по большей части существует 3 группы инсталляторов: 
<ul>
<li>развесистые монстры, которые могут как джинн выполнить почти любую, даже самую замысловатую прихоть</li> 
<li>простые и довольно ограниченные в функционале заготовки под типовые задачи</li>
<li>инсталляторы на базе скриптов</li>
</ul>
Что касается первых - искать среди них свободные и бесплатные явно не приходится. Вторые не подходили под мою не совсем тривиальную задачку. Среди третьей группы лидирует NSIS, вещь грандиозная, можно сделать что угодно, правда он полностью базируется на скриптах. Имеется плагин под Eclipse, который позволяет в конструкторе форм создавать формы страниц инсталлятора, поддерживается подсветка синтаксиса и другие полезности.

<a href="./images/inno/inno_setup.png" class="psy_img_up" title="Inno - IDE">
<img align="right" src="./images/inno/inno_setup.png" style="width:250px; margin-left:20px; margin-top:10px; margin-bottom:10px;"></a>
<br /><br />
В результате я остановилась на вполне удачном варианте - <b>Inno</b>. При помощи Wizard генерируется код заготовки под инсталлятор, потом есть возможность дополнять и менять этот код. Пишется этот код на паскале.
<br /><br />
А вот и задачка, с которой я столкнулась: по завершению инсталляции скопировать директорию, не включенную в инсталлятор, при этом заменяя файлы, сравнивая их по timestamp'ам. 
Откуда копировать директорию и куда - указывается во время установки.

<br /><br />
Вначале я сделала попытку:<br />
<span class="zecode">Source: "{code:GetFromDir}\*.*"; DestDir: "{code:GetToDir}"; Flags: comparetimestamp recursesubdirs;</span>
<br />
К желаемому результату это не привело. Скрипт вываливался с ошибкой. Как я потом поняла, Source директория определяется во время компиляции инсталлятора, поэтому секция code еще не выполняется
<br /><br />
Добавление флажка <b>'external'</b> не дало желаемого результата, поскольку, хоть при наличии этого влажка Source директория определяется во время выполнения кода, тем не менее, это происходит раньше, чем я получаю значение из соотвествующего поля инсталлятора.
<br /><br />
В результате, через некоторое время после чтения документации и общения с поисковыми системами у меня получилось следующее:
<br /><br />

<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #66d9ef">function</span> <span style="color: #a6e22e">CmpFileTimes</span><span style="color: #f8f8f2">(Source</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Dest</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">TFileTime)</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">Boolean</span><span style="color: #f92672">;</span>
<span style="color: #66d9ef">begin</span>
  <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">Source</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dwHighDateTime</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">Dest</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dwHighDateTime</span> <span style="color: #66d9ef">then</span>

       <span style="color: #f8f8f2">Result</span> <span style="color: #f92672">:=</span> <span style="color: #66d9ef">True</span>

  <span style="color: #66d9ef">else</span> <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(Source</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dwHighDateTime</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">Dest</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dwHighDateTime)</span> <span style="color: #66d9ef">and</span> 
          <span style="color: #f8f8f2">(Source</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dwLowDateTime</span> <span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">Dest</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">dwLowDateTime)</span> <span style="color: #66d9ef">then</span>

       <span style="color: #f8f8f2">Result</span> <span style="color: #f92672">:=</span> <span style="color: #66d9ef">True</span>
  <span style="color: #66d9ef">else</span> 
       <span style="color: #f8f8f2">Result</span> <span style="color: #f92672">:=</span> <span style="color: #66d9ef">False</span>

<span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>

<span style="color: #66d9ef">procedure</span> <span style="color: #a6e22e">DirectoryCopy</span><span style="color: #f8f8f2">(SourcePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DestPath</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">string</span><span style="color: #f8f8f2">)</span><span style="color: #f92672">;</span>
<span style="color: #66d9ef">var</span>
  <span style="color: #f8f8f2">FindRec</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">TFindRec</span><span style="color: #f92672">;</span>
  <span style="color: #f8f8f2">SourceFilePath</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">string</span><span style="color: #f92672">;</span>
  <span style="color: #f8f8f2">DestFilePath</span><span style="color: #f92672">:</span> <span style="color: #66d9ef">string</span><span style="color: #f92672">;</span>

  <span style="color: #f8f8f2">SourceLastWriteTime</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">TFileTime</span><span style="color: #f92672">;</span>
  <span style="color: #f8f8f2">DestLastWriteTime</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">TFileTime</span><span style="color: #f92672">;</span>

  <span style="color: #f8f8f2">DestFindRec</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">TFindRec</span><span style="color: #f92672">;</span>

<span style="color: #66d9ef">begin</span>
  <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">FindFirst(SourcePath</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;\*&#39;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">FindRec)</span> <span style="color: #66d9ef">then</span>
  <span style="color: #66d9ef">begin</span>
    <span style="color: #66d9ef">try</span>
      <span style="color: #66d9ef">repeat</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(FindRec</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Name</span> <span style="color: #f92672">&lt;&gt;</span> <span style="color: #e6db74">&#39;.&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">and</span> <span style="color: #f8f8f2">(FindRec</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Name</span> <span style="color: #f92672">&lt;&gt;</span> <span style="color: #e6db74">&#39;..&#39;</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">then</span>
        <span style="color: #66d9ef">begin</span>
          <span style="color: #f8f8f2">SourceFilePath</span> <span style="color: #f92672">:=</span> <span style="color: #f8f8f2">SourcePath</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;\&#39;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">FindRec</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Name</span><span style="color: #f92672">;</span>
          <span style="color: #f8f8f2">DestFilePath</span> <span style="color: #f92672">:=</span> <span style="color: #f8f8f2">DestPath</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&#39;\&#39;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">FindRec</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Name</span><span style="color: #f92672">;</span>
          <span style="color: #f8f8f2">SourceLastWriteTime</span> <span style="color: #f92672">:=</span> <span style="color: #f8f8f2">FindRec</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">LastWriteTime</span><span style="color: #f92672">;</span>

          <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">(FileExists(DestFilePath))</span><span style="color: #66d9ef">then</span>
          <span style="color: #66d9ef">begin</span>
               <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">FindFirst(DestFilePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DestFindRec)</span> <span style="color: #66d9ef">then</span>
               <span style="color: #66d9ef">begin</span>
                  <span style="color: #f8f8f2">DestLastWriteTime</span> <span style="color: #f92672">:=</span> <span style="color: #f8f8f2">DestFindRec</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">LastWriteTime</span><span style="color: #f92672">;</span>
               <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
          <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>

          <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">FindRec</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">Attributes</span> <span style="color: #66d9ef">and</span> <span style="color: #f8f8f2">FILE_ATTRIBUTE_DIRECTORY</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span> <span style="color: #66d9ef">then</span>
          <span style="color: #66d9ef">begin</span>
            <span style="color: #66d9ef">if</span> <span style="color: #66d9ef">not</span><span style="color: #f8f8f2">(FileExists(DestFilePath))</span> <span style="color: #66d9ef">or</span> <span style="color: #f8f8f2">CmpFileTimes(SourceLastWriteTime</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DestLastWriteTime)</span>  <span style="color: #66d9ef">then</span> 
            <span style="color: #66d9ef">begin</span>

                <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">FileCopy(SourceFilePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DestFilePath</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">False</span><span style="color: #f8f8f2">)</span> <span style="color: #66d9ef">then</span>
                <span style="color: #66d9ef">begin</span>
                  <span style="color: #f8f8f2">Log(Format(</span><span style="color: #e6db74">&#39;Copied %s to %s&#39;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">[SourceFilePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DestFilePath]))</span><span style="color: #f92672">;</span>
                <span style="color: #66d9ef">end</span>
                  <span style="color: #66d9ef">else</span>
                <span style="color: #66d9ef">begin</span>
                  <span style="color: #f8f8f2">Log(Format(</span><span style="color: #e6db74">&#39;Failed to copy %s to %s&#39;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">[SourceFilePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DestFilePath]))</span><span style="color: #f92672">;</span>
                <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>

            <span style="color: #66d9ef">end</span>
                <span style="color: #66d9ef">else</span>
            <span style="color: #66d9ef">begin</span>

                 <span style="color: #f8f8f2">Log(Format(</span><span style="color: #e6db74">&#39;File: %s in actual state&#39;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">[SourceFilePath]))</span><span style="color: #f92672">;</span>
            <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
          <span style="color: #66d9ef">end</span>
            <span style="color: #66d9ef">else</span>
          <span style="color: #66d9ef">begin</span>

            <span style="color: #66d9ef">if</span> <span style="color: #66d9ef">not</span><span style="color: #f8f8f2">(DirExists(DestFilePath))</span><span style="color: #66d9ef">then</span> 
            <span style="color: #66d9ef">begin</span>

                <span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">CreateDir(DestFilePath)</span> <span style="color: #66d9ef">then</span>
                <span style="color: #66d9ef">begin</span>
                  <span style="color: #f8f8f2">Log(Format(</span><span style="color: #e6db74">&#39;Created %s&#39;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">[DestFilePath]))</span><span style="color: #f92672">;</span>
                  <span style="color: #f8f8f2">DirectoryCopy(SourceFilePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DestFilePath)</span><span style="color: #f92672">;</span>
                <span style="color: #66d9ef">end</span>
                  <span style="color: #66d9ef">else</span>
                <span style="color: #66d9ef">begin</span>
                  <span style="color: #f8f8f2">Log(Format(</span><span style="color: #e6db74">&#39;Failed to create %s&#39;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">[DestFilePath]))</span><span style="color: #f92672">;</span>
                <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
            <span style="color: #66d9ef">end</span>
              <span style="color: #66d9ef">else</span>
            <span style="color: #66d9ef">begin</span>
                  <span style="color: #f8f8f2">Log(Format(</span><span style="color: #e6db74">&#39;Existed %s&#39;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">[DestFilePath]))</span><span style="color: #f92672">;</span>
                  <span style="color: #f8f8f2">DirectoryCopy(SourceFilePath</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">DestFilePath)</span><span style="color: #f92672">;</span>
            <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
          <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
      <span style="color: #66d9ef">until</span> <span style="color: #66d9ef">not</span> <span style="color: #f8f8f2">FindNext(FindRec)</span><span style="color: #f92672">;</span>
    <span style="color: #66d9ef">finally</span>
      <span style="color: #f8f8f2">FindClose(FindRec)</span><span style="color: #f92672">;</span>
    <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
  <span style="color: #66d9ef">end</span>
    <span style="color: #66d9ef">else</span>
  <span style="color: #66d9ef">begin</span>
    <span style="color: #f8f8f2">Log(Format(</span><span style="color: #e6db74">&#39;Failed to list %s&#39;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">[SourcePath]))</span><span style="color: #f92672">;</span>
  <span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
<span style="color: #66d9ef">end</span><span style="color: #f92672">;</span>
</pre></div>


    </div>
    

    <div class='psy_page_tags'><ul class='tags'><li><a href='./search/label/inno.html'>inno <span>1</span></a></li> </ul></div>
 
<a class="psy_blog_comment_link" href="./2017/02/inno-recursive-file-copy-timestamps.html#disqus_thread"></a>


    <div class="cleaner"></div>
</div>
<div class="psytronica_post_intro"></div>

<div class="psytronica_post even psy_post_blogpost">
    <h2><a href="./2017/01/tiddlywiki-php7-last-backups-store.html">TiddlyWiki: сохранение 10 последних резервных копий на сервере.</a></h2>

    <div class="date"><div class='psy_page_date'>30.01.2017</div></div>

    <div class="psytronica_post_content" >
        
<a class="psy_img_up" title="TiddlyWiki - нелинейный персональный веб блокнот" href="./images/wiki/wiki1.png"  ><img align="left" style="margin:0 20px 10px 10px;" src="./images/wiki/wiki1_min.png"></a>
Некоторое время назад я познакомилась с замечательной вещью - TiddlyWiki, которая позволяет сохранять информацию и структурировать ее по своему желанию. Для тех, кому надо держать свои наработки и данные в упорядоченной структуре, это прекрасное решение. От других решений она отличается большой гибкостью в своей настройке. Использовать можно на локальном компьютере, открывая ее в браузере, на нескольких компьютерах, храня файл tiddlyWiki в файлообменнике (dropbox, mail.ru облако и т.п.), а так же при необходимости можно использовать на сервере. Существуют решения и для мобильных устройств. <br />
<br />
Один из вопросов, с которым я столкнулась: как сохранить на сервере не больше 10 автоматически генерируемых резервных копий? В настройках можно либо отключить их генерацию, либо разрешить, но тогда возможное их количество может быть любым. Происходит это таким образом:<br />
<br />
Если в файле store.php переменная <b>$CLEAN_BACKUP</b> установлена <b>true</b>, то происходит уничтожение старых резервных копий. Но уничтожение файлов происходит исходя из их дат - сохраняются все резервные копии за текущий час, одна резервная копия за каждый прошлый час, по резервной копии за каждый прошлый месяц, и, соотвественно, за каждый прошлый год. Таким образом, если часто редактировать wiki у себя на сервере, количество копий может возникнуть немереное. А на сервере может быть лимит места.<br />
<br />
Это можно решить так: сохранять на сервере только несколько последних резервных копий.
Для этого можно заменить функцию cleanFiles в store.php на следующую:<br />
<br />
<br />
<!-- HTML generated using hilite.me --><div style="background: #272822; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></td><td><pre style="margin: 0; line-height: 125%">
<span style="color: #66d9ef">function</span> <span style="color: #a6e22e">cleanFiles</span><span style="color: #f8f8f2">($dirname,</span> <span style="color: #f8f8f2">$prefix){</span>

	<span style="color: #75715e">// максимальное количество сохраняемых резервных копий</span>
    <span style="color: #f8f8f2">$countBackups</span> <span style="color: #f92672">=</span><span style="color: #ae81ff">10</span><span style="color: #f8f8f2">;</span>

    <span style="color: #f8f8f2">$files</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">glob($dirname</span><span style="color: #f92672">.</span><span style="color: #e6db74">&#39;/&#39;</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">$prefix</span><span style="color: #f92672">.</span><span style="color: #e6db74">&#39;.*.html&#39;</span><span style="color: #f8f8f2">);</span>

    <span style="color: #66d9ef">if</span><span style="color: #f8f8f2">(count($files)</span> <span style="color: #f92672">&lt;=</span> <span style="color: #f8f8f2">$countBackups)</span> <span style="color: #66d9ef">return</span> <span style="color: #66d9ef">array</span><span style="color: #f8f8f2">();</span>

    <span style="color: #f8f8f2">usort($files,</span> <span style="color: #66d9ef">function</span><span style="color: #f8f8f2">($a,</span> <span style="color: #f8f8f2">$b)</span> <span style="color: #f8f8f2">{</span>
        <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">filemtime($a)</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">filemtime($b);</span>
    <span style="color: #f8f8f2">});</span>
    <span style="color: #66d9ef">return</span> <span style="color: #f8f8f2">array_slice($files,</span> <span style="color: #f8f8f2">$countBackups);</span>
<span style="color: #f8f8f2">}</span>
</pre></td></tr></table></div>

<br />
<br />
P.S: чтобы TiddlyWiki корректно работала на вашем сервере под PHP7, необходимо в store.php заменить все функции <b>split</b> на <b>explode</b><br />
<br /><br />
P.P.S: инструкция по сохранению tiddlyWiki на собственном сервере:  <a href="http://tiddlywiki.com/static/Saving%2520on%2520a%2520PHP%2520Server.html">Saving on a PHP Server</a>

    </div>
    

    <div class='psy_page_tags'><ul class='tags'><li><a href='./search/label/tiddlyWiki.html'>tiddlyWiki <span>1</span></a></li> <li><a href='./search/label/php.html'>php <span>1</span></a></li> </ul></div>
 
<a class="psy_blog_comment_link" href="./2017/01/tiddlywiki-php7-last-backups-store.html#disqus_thread"></a>


    <div class="cleaner"></div>
</div>
<div class="psytronica_post_intro"></div>

<div class="psytronica_post odd psy_post_blogpost">
    <h2><a href="./2016/11/zygoprofile-checkbox-checkboxes-html_88.html">ZygoProfile: добавлены поля checkbox, checkboxes, html</a></h2>

    <div class="date"><div class='psy_page_date'>24.11.2016</div></div>

    <div class="psytronica_post_content" >
        
<div dir="ltr" style="text-align: left;" trbidi="on">
<div class="separator" style="clear: both; text-align: center;">
<a href="#" class="psy_img_up" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;" title="Добавлены поля checkbox, checkboxes, html"><img border="0" height="172" psy_url="zygoprofile/newfields.png" src="./images/zygoprofile/newfields.png" width="200" /></a></div>
По просьбам пользователей я добавила в плагин <a href="./2015/10/joomla-3x-zygoprofile-hkmprofile.html" target="_blank">Zygo Profile</a>&nbsp;3 новых поля:<br />
<br />
<div>
<div>
<span class="zgx_li_marker glyphicon glyphicon-star-empty"></span> <b>checkbox</b>  - одинарный чекбокс</div>
<div>
<span class="zgx_li_marker glyphicon glyphicon-star-empty"></span> <b>checkboxes</b> - несколько чекбоксов, по сути поле соответствует полю списка множественного выбора</div>
<div>
<span class="zgx_li_marker glyphicon glyphicon-star-empty"></span> <b>html</b> - произвольный html-код</div>
</div>
<br />
<br />
Поля checkbox и checkboxes генерируются на основе <a href="https://docs.joomla.org/Standard_form_field_types" target="_blank">стандартных полей</a>&nbsp;Joomla</div>


    </div>
    

    <div class='psy_page_tags'><ul class='tags'><li><a href='./search/label/joomla.html'>joomla <span>8</span></a></li> <li class='green' ><a href='./search/label/zygo_profile.html'>zygo_profile <span>4</span></a></li> </ul></div>
 
<a class="psy_blog_comment_link" href="./2016/11/zygoprofile-checkbox-checkboxes-html_88.html#disqus_thread"></a>


    <div class="cleaner"></div>
</div>
<div class="psytronica_post_intro"></div>

</div>


            </div>
            <div id="psytronica_right_column">
                <div id="psytronica_right_column_inset">
                    <div id="psytronica_right_column_inner">
                      <div id="psytronica_right_column_innering">
                        
<h5>Облако тегов</h5>
<div class='psy_tags2'><a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/cke.html'>cke<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='4' style='font-size:14px; color:rgba(255, 163, 80, 1)' href='./search/label/eclipse.html'>eclipse<span>&nbsp;(4)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/filemanager.html'>filemanager<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/inno.html'>inno<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/jlnodoubles.html'>jlnodoubles<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='8' style='font-size:20px; color:rgba(255, 221, 173, 1)' href='./search/label/joomla.html'>joomla<span>&nbsp;(8)</span></a> <a class='psy_tag_calc_link' tagcount='2' style='font-size:11px; color:rgba(255, 111, 73, 1)' href='./search/label/joomshopping.html'>joomshopping<span>&nbsp;(2)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/php.html'>php<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='4' style='font-size:14px; color:rgba(255, 163, 80, 1)' href='./search/label/plug-in_development.html'>plug-in development<span>&nbsp;(4)</span></a>  <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/shnodoubles.html'>shnodoubles<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/tiddlyWiki.html'>tiddlyWiki<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/ubuntu.html'>ubuntu<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='4' style='font-size:14px; color:rgba(255, 163, 80, 1)' href='./search/label/zygo_profile.html'>zygo_profile<span>&nbsp;(4)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/друзья.html'>друзья<span>&nbsp;(1)</span></a> <a class='psy_tag_calc_link' tagcount='4' style='font-size:14px; color:rgba(255, 163, 80, 1)' href='./search/label/разработки.html'>разработки<span>&nbsp;(4)</span></a> <a class='psy_tag_calc_link' tagcount='1' style='font-size:10px; color:rgba(255, 80, 80, 1)' href='./search/label/санскрит.html'>санскрит<span>&nbsp;(1)</span></a> </div>
 
<h5>Меню</h5>
<ul class="psy_right_menu">
<li><a href='./#blog' class='psy_noactive'>Главная</a></li>
<li><a href='./section/Создание_собственного_отладчика_в_Eclipse.html' class='psy_noactive'>Создание собственного отладчика в Eclipse</a></li>
<li><a href='./section/санскрит.html' class='psy_noactive'>Санскрит - немножко перевожу</a></li>
<li><a href='./section/camino_latino.html' class='psy_noactive'>Camino Latino - истории о латинской америке</a></li>
</ul>
<h5>Архив</h5>
<div class='psy_archive'>
    <div class='psy_archive_elems' style='display:none'>
            <span class='el_open'>&#9660;&#160;</span>
            <span class='el_closed'>&#9658;&#160;</span>
    </div>
    <ul class='psy_archive_years'><li class='last_year' >
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-open'>&#9660;&#160;</span>
                    </a>
                    <a class='psy_year_title' href='#'>2017</a><ul class='psy_archive_mons'><li class='last_month' >
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-open'>&#9660;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>03</a><ul class='psy_archive_days'><li><a href='./2017/03/eclipse-wizard-open-programmatically.html'>Вызов wizard'а в Eclipse по кнопке или по shortcut'y в меню</a></li><li><a href='./2017/03/eclipse-custom-project-nature-icons.html'>Eclipse: особые иконки в Project Explorer для проекта с определенной Nature</a></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>02</a><ul class='psy_archive_days'><li><a href='./2017/02/joomshopping-list-to-text-attribute.html'>Joomshopping - замена выпадающих списков с единственным элементом на текст в независимых атрибутах</a></li><li><a href='./2017/02/cke-joomla3-problem.html'>Фикс: проблема с CKE-редактором под Joomla 3</a></li><li><a href='./2017/02/zygo-profile-autoupdates-webcam.html'>Новый релиз Zygo Profile: автообновления, камера, поддержка Joomla 3.7</a></li><li><a href='./2017/02/Zygo-Joomshopping-Review-Captcha.html'>Zygo Joomshopping Review Captcha - капча KCaptcha для отзывов в интернет-магазине Joomshopping</a></li><li><a href='./2017/02/svetomaster_video.html'>Подарок от Евгения</a></li><li><a href='./2017/02/inno-recursive-file-copy-timestamps.html'>Inno - создание инсталлятора. Рекурсивное копирование файлов внешней директории, учитывая даты.</a></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>01</a><ul class='psy_archive_days'><li><a href='./2017/01/tiddlywiki-php7-last-backups-store.html'>TiddlyWiki: сохранение 10 последних резервных копий на сервере.</a></li></ul></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_year_title' href='#'>2016</a><ul class='psy_archive_mons'><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>11</a><ul class='psy_archive_days'><li><a href='./2016/11/zygoprofile-checkbox-checkboxes-html_88.html'>ZygoProfile: добавлены поля checkbox, checkboxes, html</a></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>10</a><ul class='psy_archive_days'><li><a href='./2016/10/zygoprofile.html'>ZygoProfile - назначение полей группам пользователей.</a></li><li><a href='./2016/10/shabdatra.html'>Санскрит -  запоминание глагольных форм</a></li></ul></li></ul></li><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_year_title' href='#'>2015</a><ul class='psy_archive_mons'><li>
                    <a class='toggle' href='javascript:void(0)'>
                        <span class='zippy toggle-closed'>&#9658;&#160;</span>
                    </a>
                    <a class='psy_mon_title' href='#'>10</a><ul class='psy_archive_days'><li><a href='./2015/10/joomla-3x-zygoprofile-hkmprofile.html'>Плагин расширенного профиля Joomla 3.x с поддержкой аватаров (обработка имиджей, обрезка миниатюр) - Zygo Profile</a></li><li><a href='./2015/10/eclipse-ivaluevariable-idynamicvariable.html'>Переменные в плагинах Eclipse. Интерфейсы IValueVariable и IDynamicVariable</a></li><li><a href='./2015/10/verbos-irregulares-android-kivy-python.html'>Verbos irregulares - приложение для android для запоминания неправильных испанских глаголов.</a></li><li><a href='./2015/10/eclipse-ubuntu-linux.html'>Открыть ресурс в файловом менеджере - плагин для Eclipse под Ubuntu Linux.</a></li></li></ul></li></ul></div>

                      </div>
                    </div>
                    <div id="psytronica_right_column_inner_after"></div>
                </div>

            </div>
          	<div class="cleaner"></div>
        </div>
        <div id="psy_after_main"></div>
        <div class='psy_pagination'><a class='psy_page_first' href='./index.html'><span> &lt;&lt; </span></a><a class='psy_page_prev' href='./index.html'><span> &lt; </span></a><a class='psy_page_other' href='./index.html'><span>1</span></a><span class='psy_page_cur' ><span>2</span></span><a class='psy_page_other' href='./page3.html'><span>3</span></a><a class='psy_page_other' href='./page4.html'><span>4</span></a><a class='psy_page_next' href='./page3.html'><span> &gt; </span></a><a class='psy_page_end' href='./page4.html'><span> &gt;&gt; </span></a><div class='clearfix'></div></div>
    </div>
</div>

<div class="cleaner"></div>



<div id="psytronica_cr_bar_wrapper">
	<div id="psytronica_cr_bar">
    	
© Psytronica.ru. Блог существа SherZa. 2015-2017

        <a href="#top" class="to_anchor">Наверх</a>
    </div>
</div>


<div id="dsq-count-scr-wrapper"></div>



  

<!-- Yandex.Metrika counter -->
<script type="text/javascript">
  $(document).ready(function(){

    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter33338883 = new Ya.Metrika({
                    id:33338883,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
  });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/33338883" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->


<script>
  $(document).ready(function(){
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-91608488-1', 'auto');
  ga('send', 'pageview');
  });
</script>

</div>  
 <style>
   body{
   	background: #2d261a;
   }
   body #psy_body_inner{
		opacity:1;
    } 
  </style> 
</body>
</html>

